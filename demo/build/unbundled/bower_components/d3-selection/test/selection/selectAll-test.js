var tape=require("tape"),jsdom=require("../jsdom"),d3=require("../../");tape("selection.selectAll(…) returns a selection",function(e){var l=jsdom("<h1>hello</h1>");e.ok(d3.select(l).selectAll("h1")instanceof d3.selection),e.end()}),tape("selection.selectAll(string) selects all descendants that match the selector string for each selected element",function(e){var l=jsdom("<h1 id='one'><span></span><span></span></h1><h1 id='two'><span></span><span></span></h1>"),t=l.querySelector("#one"),n=l.querySelector("#two");e.deepEqual(d3.selectAll([t,n]).selectAll("span"),{_groups:[t.querySelectorAll("span"),n.querySelectorAll("span")],_parents:[t,n]}),e.end()}),tape("selection.selectAll(function) selects the return values of the given function for each selected element",function(e){var l=jsdom("<span id='one'></span>"),t=l.querySelector("#one");e.deepEqual(d3.select(l).selectAll(function(){return[t]}),{_groups:[[t]],_parents:[l]}),e.end()}),tape("selection.selectAll(function) passes the selector function data, index and group",function(e){var l=jsdom("<parent id='one'><child id='three'></child><child id='four'></child></parent><parent id='two'><child id='five'></child></parent>"),t=l.querySelector("#one"),n=l.querySelector("#two"),r=l.querySelector("#three"),s=l.querySelector("#four"),c=l.querySelector("#five"),i=[];d3.selectAll([t,n]).datum(function(e,l){return"parent-"+l}).selectAll("child").data(function(e,l){return[0,1].map(function(e){return"child-"+l+"-"+e})}).selectAll(function(e,l,t){i.push([this,e,l,t])}),e.deepEqual(i,[[r,"child-0-0",0,[r,s]],[s,"child-0-1",1,[r,s]],[c,"child-1-0",0,[c]]]),e.end()}),tape("selection.selectAll(…) will not propagate data",function(e){var l=jsdom("<parent><child>hello</child></parent>"),t=l.querySelector("parent"),n=l.querySelector("child");t.__data__=42,d3.select(t).selectAll("child"),e.ok(!("__data__"in n)),e.end()}),tape("selection.selectAll(…) groups selected elements by their parent in the originating selection",function(e){var l=jsdom("<parent id='one'><child id='three'></child></parent><parent id='two'><child id='four'></child></parent>"),t=l.querySelector("#one"),n=l.querySelector("#two"),r=l.querySelector("#three"),s=l.querySelector("#four");e.deepEqual(d3.select(l).selectAll("parent").selectAll("child"),{_groups:[[r],[s]],_parents:[t,n]}),e.deepEqual(d3.select(l).selectAll("child"),{_groups:[[r,s]],_parents:[l]}),e.end()}),tape("selection.selectAll(…) can select elements when the originating selection is nested",function(e){var l=jsdom("<parent id='one'><child id='three'><span id='five'></span></child></parent><parent id='two'><child id='four'><span id='six'></span></child></parent>"),t=l.querySelector("#one"),n=l.querySelector("#two"),r=l.querySelector("#three"),s=l.querySelector("#four"),c=l.querySelector("#five"),i=l.querySelector("#six");e.deepEqual(d3.selectAll([t,n]).selectAll("child").selectAll("span"),{_groups:[[c],[i]],_parents:[r,s]}),e.end()}),tape("selection.selectAll(…) skips missing originating elements",function(e){var l=jsdom("<h1><span>hello</span></h1>"),t=l.querySelector("h1"),n=l.querySelector("span");e.deepEqual(d3.selectAll([,t]).selectAll("span"),{_groups:[[n]],_parents:[t]}),e.deepEqual(d3.selectAll([null,t]).selectAll("span"),{_groups:[[n]],_parents:[t]}),e.deepEqual(d3.selectAll([void 0,t]).selectAll("span"),{_groups:[[n]],_parents:[t]}),e.end()}),tape("selection.selectAll(…) skips missing originating elements when the originating selection is nested",function(e){var l=jsdom("<parent id='one'><child></child><child id='three'><span id='five'></span></child></parent><parent id='two'><child></child><child id='four'><span id='six'></span></child></parent>"),t=l.querySelector("#one"),n=l.querySelector("#two"),r=l.querySelector("#three"),s=l.querySelector("#four"),c=l.querySelector("#five"),i=l.querySelector("#six");e.deepEqual(d3.selectAll([t,n]).selectAll("child").select(function(e,l){return 1&l?this:null}).selectAll("span"),{_groups:[[c],[i]],_parents:[r,s]}),e.end()});