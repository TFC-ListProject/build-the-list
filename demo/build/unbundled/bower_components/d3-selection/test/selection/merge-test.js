var tape=require("tape"),jsdom=require("../jsdom"),d3=require("../../");tape("selection.merge(selection) returns a new selection, merging the two selections",function(e){var t=jsdom("<h1 id='one'>one</h1><h1 id='two'>two</h1>"),l=t.body,r=t.querySelector("#one"),s=t.querySelector("#two"),c=d3.select(l).selectAll("h1"),n=c.select(function(e,t){return 1&t?this:null}),o=c.select(function(e,t){return 1&t?null:this});e.deepEqual(n.merge(o),{_groups:[[r,s]],_parents:[l]}),e.deepEqual(n,{_groups:[[,s]],_parents:[l]}),e.deepEqual(o,{_groups:[[r]],_parents:[l]}),e.end()}),tape("selection.merge(selection) returns a selection with the same size and parents as this selection",function(e){var t=jsdom("<h1 id='one'>one</h1><h1 id='two'>two</h1>"),l=jsdom("<h1 id='one'>one</h1><h1 id='two'>two</h1><h1 id='three'>three</h1>"),r=t.body,s=l.body,c=t.querySelector("#one"),n=l.querySelector("#one"),o=t.querySelector("#two"),i=l.querySelector("#two"),d=l.querySelector("#three");e.deepEqual(d3.select(r).selectAll("h1").merge(d3.select(s).selectAll("h1")),{_groups:[[c,o]],_parents:[r]}),e.deepEqual(d3.select(s).selectAll("h1").merge(d3.select(r).selectAll("h1")),{_groups:[[n,i,d]],_parents:[s]}),e.end()}),tape("selection.merge(selection) reuses groups from this selection if the other selection has fewer groups",function(e){var t=jsdom("<parent><child></child><child></child></parent><parent><child></child><child></child></parent>"),l=t.body,r=d3.select(l).selectAll("parent").selectAll("child"),s=d3.select(l).selectAll("parent:first-child").selectAll("child"),c=r.merge(s),n=s.merge(r);e.deepEqual(c,r),e.deepEqual(n,s),e.equal(c._groups[1],r._groups[1]),e.end()}),tape("selection.merge(selection) reuses this selectionâ€™s parents",function(e){var t=jsdom("<parent><child></child><child></child></parent><parent><child></child><child></child></parent>"),l=t.body,r=d3.select(l).selectAll("parent").selectAll("child"),s=d3.select(l).selectAll("parent:first-child").selectAll("child"),c=r.merge(s),n=s.merge(r);e.equal(c._parents,r._parents),e.equal(n._parents,s._parents),e.end()});