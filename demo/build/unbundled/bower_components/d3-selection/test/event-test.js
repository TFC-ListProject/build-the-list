var tape=require("tape"),jsdom=require("./jsdom"),d3=require("../");tape("d3.event is set exactly during the callback of an event listener",function(e){var t,n=jsdom("<h1 id='one'></h1>"),l=n.querySelector("#one"),a=d3.selectAll([l]).on("click",function(){t=d3.event});e.equal(d3.event,null),a.dispatch("click"),e.equal(d3.event,null),e.equal(t.type,"click"),e.equal(t.target,l),e.end()}),tape("d3.event is restored to its previous value during reentrant events",function(e){var t,n,l,a=jsdom("<h1 id='one'></h1>"),o=a.querySelector("#one"),d=d3.selectAll([o]).on("foo",function(){t=d3.event,d.dispatch("bar"),l=d3.event}).on("bar",function(){n=d3.event});e.equal(d3.event,null),d.dispatch("foo"),e.equal(d3.event,null),e.equal(t.type,"foo"),e.equal(n.type,"bar"),e.equal(l,t),e.end()});