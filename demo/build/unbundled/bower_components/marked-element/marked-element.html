<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="marked-import.html">


</head><body><dom-module id="marked-element">
  <template>
    <style>:host{display:block;}.hidden{display:none !important;}</style>
    <content select=".markdown-html"></content>
    <div id="content" class="hidden"></div>
  </template>

</dom-module>

<script>"use strict";Polymer({is:"marked-element",properties:{markdown:{observer:"render",type:String,value:null},breaks:{observer:"render",type:Boolean,value:!1},pedantic:{observer:"render",type:Boolean,value:!1},renderer:{observer:"render",type:Function,value:null},sanitize:{observer:"render",type:Boolean,value:!1},smartypants:{observer:"render",type:Boolean,value:!1},callback:{observer:"render",type:Function,value:null},xhr:{type:Object,notify:!0,readOnly:!0}},ready:function(){if(!this.markdown&&(this._markdownElement=Polymer.dom(this).querySelector('[type="text/markdown"]'),this._markdownElement))if(this.markdown=this._unindent(this._markdownElement.textContent),this._markdownElement.src)this._request(this._markdownElement.src);else{var e=new MutationObserver(this._onScriptAttributeChanged.bind(this));e.observe(this._markdownElement,{attributes:!0})}},attached:function(){this._attached=!0,this._outputElement=this.outputElement,this.render()},detached:function(){this._attached=!1},unindent:function(e){return this._unindent(e)},get outputElement(){var e=Polymer.dom(this).queryDistributedElements(".markdown-html")[0];return e?e:(this.toggleClass("hidden",!1,this.$.content),this.$.content)},render:function(){if(this._attached){if(!this.markdown)return void(Polymer.dom(this._outputElement).innerHTML="");var e=new marked.Renderer;this.renderer&&this.renderer(e);var t={renderer:e,highlight:this._highlight.bind(this),breaks:this.breaks,sanitize:this.sanitize,pedantic:this.pedantic,smartypants:this.smartypants};Polymer.dom(this._outputElement).innerHTML=marked(this.markdown,t,this.callback),this.fire("marked-render-complete")}},_highlight:function(e,t){var r=this.fire("syntax-highlight",{code:e,lang:t});return r.detail.code||e},_unindent:function(e){if(!e)return e;var t=e.replace(/\t/g,"  ").split("\n"),r=t.reduce(function(e,t){if(/^\s*$/.test(t))return e;var r=t.match(/^(\s*)/)[0].length;return null===e?r:e>r?r:e},null);return t.map(function(e){return e.substr(r)}).join("\n")},_request:function(e){this._setXhr(new XMLHttpRequest);var t=this.xhr;return t.readyState>0?null:(t.addEventListener("error",this._handleError.bind(this)),t.addEventListener("loadend",function(e){var t=this.xhr.status||0;0===t||t>=200&&300>t?(this.sanitize=!0,this.markdown=e.target.response):this._handleError(e),this.fire("marked-loadend",e)}.bind(this)),t.open("GET",e),t.setRequestHeader("Accept","text/markdown"),void t.send())},_handleError:function(e){var t=this.fire("marked-request-error",e,{cancelable:!0});t.defaultPrevented||(this.markdown="Failed loading markdown source")},_onScriptAttributeChanged:function(e){"src"===e[0].attributeName&&this._request(this._markdownElement.src)}});</script>
</body></html>