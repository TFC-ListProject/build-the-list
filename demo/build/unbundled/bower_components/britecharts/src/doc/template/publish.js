"use strict";function find(e){return helper.find(data,e)}function tutoriallink(e){return helper.toTutorial(e,null,{tag:"em",classname:"disabled",prefix:"Tutorial: "})}function getAncestorLinks(e){return helper.getAncestorLinks(data,e)}function hashToLink(e,n){if(!/^(#.+)/.test(n))return n;var a=helper.createLink(e);return a=a.replace(/(#.+|$)/,n),'<a href="'+a+'">'+n+"</a>"}function needsSignature(e){var n=!1;if("function"===e.kind||"class"===e.kind)n=!0;else if("typedef"===e.kind&&e.type&&e.type.names&&e.type.names.length)for(var a=0,t=e.type.names.length;t>a;a++)if("function"===e.type.names[a].toLowerCase()){n=!0;break}return n}function addSignatureParams(e){var n="optional",a=helper.getSignatureParams(e,n);e.signature=(e.signature||"")+"(";for(var t=0,l=a.length;l>t;t++){var i=a[t],r=t>0?", ":"";if(new RegExp("class=[\"|']"+n+"[\"|']").test(i)){var o=new RegExp("<span class=[\"|']"+n+"[\"|']>(.*?)<\\/span>","i");e.signature+=i.replace(o," $`["+r+"$1$']")}else e.signature+=r+i}e.signature+=")"}function addSignatureReturns(e){if(navOptions.methodHeadingReturns){var n=helper.getSignatureReturns(e);e.signature='<span class="signature">'+(e.signature||"")+'</span><span class="type-signature">'+(n.length?" &rarr; {"+n.join("|")+"}":"")+"</span>"}else e.signature=e.signature||""}function addSignatureTypes(e){var n=helper.getSignatureTypes(e);e.signature=(e.signature||"")+'<span class="type-signature">'+(n.length?" :"+n.join("|"):"")+"</span>"}function addAttribs(e){var n=helper.getAttribs(e);e.attribs='<span class="type-signature">'+htmlsafe(n.length?"<"+n.join(", ")+"> ":"")+"</span>"}function shortenPaths(e,n){return Object.keys(e).forEach(function(a){e[a].shortened=e[a].resolved.replace(n,"").replace(/\\/g,"/")}),e}function getPathFromDoclet(e){return e.meta?path.normalize(e.meta.path&&"null"!==e.meta.path?e.meta.path+"/"+e.meta.filename:e.meta.filename):void 0}function searchData(e){var n=e.indexOf('<div class="container">');if(n>0){var a=e.indexOf('<div class="container">',n+2);a>0&&(n=a),e=e.slice(n)}var t=e.indexOf('<span class="copyright">');t>0&&(e=e.substring(0,t));var l=sanitizeHtml(e,{allowedTags:[],allowedAttributes:[]});return l=l.replace(/\s+/g," ")}function generate(e,n,a,t,l){l=l!==!1;var i={title:n,docs:a,docType:e},r=path.join(outdir,t),o=view.render("container.tmpl",i);l&&(o=helper.resolveLinks(o)),searchEnabled&&(searchableDocuments[t]={id:t,title:n,body:searchData(o)}),fs.writeFileSync(r,o,"utf8")}function generateSourceFiles(e){Object.keys(e).forEach(function(n){var a,t=helper.getUniqueFilename(e[n].shortened);helper.registerLink(e[n].shortened,t);try{a={kind:"source",code:helper.htmlsafe(fs.readFileSync(e[n].resolved,"utf8"))}}catch(l){handle(l)}generate("source","Source: "+e[n].shortened,[a],t,!1)})}function attachModuleSymbols(e,n){var a={};return e.forEach(function(e){a[e.longname]=a[e.longname]||[],a[e.longname].push(e)}),n.map(function(e){a[e.longname]&&(e.modules=a[e.longname].filter(function(e){return e.description||"class"===e.kind}).map(function(e){return e=doop(e),"class"!==e.kind&&"function"!==e.kind||(e.name=e.name.replace("module:",'(require("')+'"))'),e}))})}function buildNav(e){var n={},a=navigationMaster;e.modules.length&&e.modules.forEach(function(e){hasOwnProp.call(n,e.longname)||a.module.members.push(linkto(e.longname,e.longname.replace("module:",""))),n[e.longname]=!0}),e.externals.length&&e.externals.forEach(function(e){hasOwnProp.call(n,e.longname)||a.external.members.push(linkto(e.longname,e.name.replace(/(^"|"$)/g,""))),n[e.longname]=!0}),e.classes.length&&e.classes.forEach(function(e){hasOwnProp.call(n,e.longname)||a["class"].members.push(linkto(e.longname,e.longname.replace("module:",""))),n[e.longname]=!0}),e.events.length&&e.events.forEach(function(e){hasOwnProp.call(n,e.longname)||a.event.members.push(linkto(e.longname,e.longname.replace("module:",""))),n[e.longname]=!0}),e.namespaces.length&&e.namespaces.forEach(function(e){hasOwnProp.call(n,e.longname)||a.namespace.members.push(linkto(e.longname,e.longname.replace("module:",""))),n[e.longname]=!0}),e.mixins.length&&e.mixins.forEach(function(e){hasOwnProp.call(n,e.longname)||a.mixin.members.push(linkto(e.longname,e.longname.replace("module:",""))),n[e.longname]=!0}),e.interfaces&&e.interfaces.length&&e.interfaces.forEach(function(e){hasOwnProp.call(n,e.longname)||a["interface"].members.push(linkto(e.longname,e.longname.replace("module:",""))),n[e.longname]=!0}),e.tutorials.length&&e.tutorials.forEach(function(e){a.tutorial.members.push(tutoriallink(e.name))}),e.globals.length&&(e.globals.forEach(function(e){"typedef"===e.kind||hasOwnProp.call(n,e.longname)||a.global.members.push(linkto(e.longname,e.longname.replace("module:",""))),n[e.longname]=!0}),0===a.global.members.length&&a.global.members.push(linkto("global","Types")));var t=[];_.each(a,function(e,n){e.members.length>0&&"index"!==n&&t.push({title:e.title,link:e.link,members:e.members})}),a.topLevelNav=t}var template=require("jsdoc/template"),doop=require("jsdoc/util/doop"),fs=require("jsdoc/fs"),_=require("underscore"),path=require("jsdoc/path"),taffy=require("taffydb").taffy,handle=require("jsdoc/util/error").handle,helper=require("jsdoc/util/templateHelper"),moment=require("moment"),htmlsafe=helper.htmlsafe,sanitizeHtml=require("sanitize-html"),linkto=helper.linkto,resolveAuthorLinks=helper.resolveAuthorLinks,scopeToPunc=helper.scopeToPunc,hasOwnProp=Object.prototype.hasOwnProperty,conf=env.conf.templates||{},data,view,outdir=env.opts.destination,searchEnabled=conf.search!==!1,globalUrl=helper.getUniqueFilename("global"),indexUrl=helper.getUniqueFilename("index"),navOptions={includeDate:conf.includeDate!==!1,logoFile:conf.logoFile,systemName:conf.systemName||"Documentation",navType:conf.navType||"vertical",footer:conf.footer||"",copyright:conf.copyright||"",theme:conf.theme||"simplex",syntaxTheme:conf.syntaxTheme||"default",linenums:conf.linenums,collapseSymbols:conf.collapseSymbols||!1,inverseNav:conf.inverseNav,outputSourceFiles:conf.outputSourceFiles===!0,sourceRootPath:conf.sourceRootPath,disablePackagePath:conf.disablePackagePath,outputSourcePath:conf.outputSourcePath,dateFormat:conf.dateFormat,analytics:conf.analytics||null,methodHeadingReturns:conf.methodHeadingReturns===!0,sort:conf.sort,search:searchEnabled},searchableDocuments={},navigationMaster={index:{title:navOptions.systemName,link:indexUrl,members:[]},namespace:{title:"Namespaces",link:helper.getUniqueFilename("namespaces.list"),members:[]},module:{title:"API",link:helper.getUniqueFilename("modules.list"),members:[]},"class":{title:"Classes",link:helper.getUniqueFilename("classes.list"),members:[]},mixin:{title:"Mixins",link:helper.getUniqueFilename("mixins.list"),members:[]},event:{title:"Events",link:helper.getUniqueFilename("events.list"),members:[]},"interface":{title:"Interfaces",link:helper.getUniqueFilename("interfaces.list"),members:[]},tutorial:{title:"Demos",link:helper.getUniqueFilename("tutorials.list"),members:[]},global:{title:"Global",link:globalUrl,members:[]},external:{title:"Externals",link:helper.getUniqueFilename("externals.list"),members:[]}};exports.publish=function(e,n,a){function t(e,n,a){var t={title:e,header:n.title,content:n.parse(),children:n.children,docs:null},l=path.join(outdir,a),i=view.render("tutorial.tmpl",t);i=helper.resolveLinks(i),searchEnabled&&(searchableDocuments[a]={id:a,title:e,body:searchData(i)}),fs.writeFileSync(l,i,"utf8")}function l(e){e.children.forEach(function(e){t("Tutorial: "+e.title,e,helper.tutorialToUrl(e.name)),l(e)})}function i(e,n,a){var t={searchableDocuments:JSON.stringify(n),navOptions:a},l=fs.readFileSync(e+"/quicksearch.tmpl").toString(),i=_.template(l),r=i(t),o=path.join(outdir,"quicksearch.html");fs.writeFileSync(o,r,"utf8")}data=e,conf["default"]=conf["default"]||{};var r=n.template;view=new template.Template(r+"/tmpl"),helper.registerLink("global",globalUrl),view.layout=conf["default"].layoutFile?path.getResourcePath(path.dirname(conf["default"].layoutFile),path.basename(conf["default"].layoutFile)):"layout.tmpl",helper.setTutorials(a),data=helper.prune(data);var o=void 0===navOptions.sort?n.sort:navOptions.sort;o=void 0===o?!0:o,o=o===!0?"longname, version, since":o,o&&data.sort(o),helper.addEventListeners(data);var s={},c=[];data().each(function(e){e.attribs="",e.examples&&(e.examples=e.examples.map(function(e){var n,a;e.match(/^\s*(<p>)?<caption>([\s\S]+?)<\/caption>(\s*)([\s\S]+?)(<\/p>)?$/i)&&(n=RegExp.$2,e=RegExp.$4+(RegExp.$1?"":RegExp.$5));var a=/{@lang (.*?)}/.exec(e);return a&&a[1]?(e=e.replace(a[0],""),a=a[1]):a=null,{caption:n||"",code:e,lang:a||"javascript"}})),e.see&&e.see.forEach(function(n,a){e.see[a]=hashToLink(e,n)});var n;e.meta&&(n=getPathFromDoclet(e),s[n]={resolved:n,shortened:null},-1===c.indexOf(n)&&c.push(n))});var m=(find({kind:"package"})||[])[0];navOptions.disablePackagePath!==!0&&m&&m.name&&(outdir=m.version?path.join(outdir,m.name,m.version):path.join(outdir,m.name)),fs.mkPath(outdir);var u=path.join(r,"static"),p=fs.ls(u,3);p.forEach(function(e){var n=fs.toDir(e.replace(u,outdir));fs.mkPath(n),fs.copyFileSync(e,n)});var h,d,g;if(conf["default"].staticFiles&&(h=conf["default"].staticFiles.include||conf["default"].staticFiles.paths||[],d=new(require("jsdoc/src/filter").Filter)(conf["default"].staticFiles),g=new(require("jsdoc/src/scanner").Scanner),h.forEach(function(e){var n=g.scan([e],10,d);n.forEach(function(n){var a=fs.toDir(e),t=fs.toDir(n.replace(a,outdir));fs.mkPath(t),fs.copyFileSync(n,t)})})),c.length){var f=navOptions.sourceRootPath;f||(f=path.commonPrefix(c)),s=shortenPaths(s,f)}data().each(function(e){var n=helper.createLink(e);helper.registerLink(e.longname,n);var a;e.meta&&(a=getPathFromDoclet(e),_.isEmpty(s[a])||(a=s[a].shortened,a&&(e.meta.shortpath=a)))}),data().each(function(e){var n=helper.longnameToUrl[e.longname];n.indexOf("#")>-1?e.id=helper.longnameToUrl[e.longname].split(/#/).pop():e.id=e.name,needsSignature(e)&&(addSignatureParams(e),addSignatureReturns(e),addAttribs(e))}),data().each(function(e){e.ancestors=getAncestorLinks(e),"member"===e.kind&&(addSignatureTypes(e),addAttribs(e)),"constant"===e.kind&&(addSignatureTypes(e),addAttribs(e),e.kind="member")});var v=helper.getMembers(data);v.tutorials=a.children,view.find=find,view.linkto=linkto,view.resolveAuthorLinks=resolveAuthorLinks,view.tutoriallink=tutoriallink,view.htmlsafe=htmlsafe,view.moment=moment,buildNav(v),view.nav=navigationMaster,view.navOptions=navOptions,attachModuleSymbols(find({kind:["class","function"],longname:{left:"module:"}}),v.modules),navOptions.outputSourceFiles&&generateSourceFiles(s),v.globals.length&&generate("global","Global",[{kind:"globalobj"}],globalUrl),view.nav.module&&view.nav.module.members.length&&generate("module",view.nav.module.title,[{kind:"sectionIndex",contents:view.nav.module}],navigationMaster.module.link),view.nav["class"]&&view.nav["class"].members.length&&generate("class",view.nav["class"].title,[{kind:"sectionIndex",contents:view.nav["class"]}],navigationMaster["class"].link),view.nav.namespace&&view.nav.namespace.members.length&&generate("namespace",view.nav.namespace.title,[{kind:"sectionIndex",contents:view.nav.namespace}],navigationMaster.namespace.link),view.nav.mixin&&view.nav.mixin.members.length&&generate("mixin",view.nav.mixin.title,[{kind:"sectionIndex",contents:view.nav.mixin}],navigationMaster.mixin.link),view.nav["interface"]&&view.nav["interface"].members.length&&generate("interface",view.nav["interface"].title,[{kind:"sectionIndex",contents:view.nav["interface"]}],navigationMaster["interface"].link),view.nav.external&&view.nav.external.members.length&&generate("external",view.nav.external.title,[{kind:"sectionIndex",contents:view.nav.external}],navigationMaster.external.link),view.nav.tutorial&&view.nav.tutorial.members.length&&generate("tutorial",view.nav.tutorial.title,[{kind:"sectionIndex",contents:view.nav.tutorial}],navigationMaster.tutorial.link);var b=find({kind:"file"}),k=find({kind:"package"});generate("index","Index",k.concat([{kind:"mainpage",readme:n.readme,longname:n.mainpagetitle?n.mainpagetitle:"Main Page"}]).concat(b),indexUrl);var x=taffy(v.classes),y=taffy(v.modules),w=taffy(v.namespaces),P=taffy(v.mixins),F=taffy(v.interfaces),S=taffy(v.externals);for(var E in helper.longnameToUrl)if(hasOwnProp.call(helper.longnameToUrl,E)){var O=helper.find(x,{longname:E});O.length&&generate("class","Class: "+O[0].name,O,helper.longnameToUrl[E]);var T=helper.find(y,{longname:E});T.length&&generate("module","API: "+T[0].name,T,helper.longnameToUrl[E]);var U=helper.find(w,{longname:E});U.length&&generate("namespace","Namespace: "+U[0].name,U,helper.longnameToUrl[E]);var q=helper.find(P,{longname:E});q.length&&generate("mixin","Mixin: "+q[0].name,q,helper.longnameToUrl[E]);var j=helper.find(F,{longname:E});j.length&&generate("interface","Interface: "+j[0].name,j,helper.longnameToUrl[E]);var L=helper.find(S,{longname:E});L.length&&generate("external","External: "+L[0].name,L,helper.longnameToUrl[E])}l(a),searchEnabled&&i(r+"/tmpl",searchableDocuments,navOptions)};