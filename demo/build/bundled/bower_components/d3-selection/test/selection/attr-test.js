var tape=require("tape"),jsdom=require("../jsdom"),d3=require("../../");tape("selection.attr(name) returns the value of the attribute with the specified name on the first selected element",function(e){var t=jsdom("<h1 class='c1 c2'>hello</h1><h1 class='c3'></h1>");e.equal(d3.select(t).select("h1").attr("class"),"c1 c2"),e.equal(d3.selectAll([null,t]).select("h1").attr("class"),"c1 c2"),e.end()}),tape("selection.attr(name) coerces the specified name to a string",function(e){var t=jsdom("<h1 class='c1 c2'>hello</h1><h1 class='c3'></h1>");e.equal(d3.select(t).select("h1").attr({toString:function(){return"class"}}),"c1 c2"),e.end()}),tape("selection.attr(name) observes the namespace prefix, if any",function(e){var t=d3.select({getAttribute:function(e){return"foo"===e?"bar":null},getAttributeNS:function(e,t){return"http://www.w3.org/2000/svg"===e&&"foo"===t?"svg:bar":null}});e.equal(t.attr("foo"),"bar"),e.equal(t.attr("svg:foo"),"svg:bar"),e.end()}),tape("selection.attr(name) observes a custom namespace prefix, if any",function(e){var t=d3.select({getAttributeNS:function(e,t){return"https://d3js.org/2016/namespace"===e&&"pie"===t?"tasty":null}});try{d3.namespaces.d3js="https://d3js.org/2016/namespace",e.equal(t.attr("d3js:pie"),"tasty")}finally{delete d3.namespaces.d3js}e.end()}),tape("selection.attr(name, value) observes the namespace prefix, if any",function(e){var t,o=d3.select({setAttribute:function(e,o){t="foo"===e?o:null},setAttributeNS:function(e,o,a){t="http://www.w3.org/2000/svg"===e&&"foo"===o?a:null}});e.equal((t=void 0,o.attr("foo","bar"),t),"bar"),e.equal((t=void 0,o.attr("svg:foo","svg:bar"),t),"svg:bar"),e.equal((t=void 0,o.attr("foo",function(){return"bar"}),t),"bar"),e.equal((t=void 0,o.attr("svg:foo",function(){return"svg:bar"}),t),"svg:bar"),e.end()}),tape("selection.attr(name, null) observes the namespace prefix, if any",function(e){var t,o=d3.select({removeAttribute:function(e){t="foo"===e?"foo":null},removeAttributeNS:function(e,o){t="http://www.w3.org/2000/svg"===e&&"foo"===o?"svg:foo":null}});e.equal((t=void 0,o.attr("foo",null),t),"foo"),e.equal((t=void 0,o.attr("svg:foo",null),t),"svg:foo"),e.equal((t=void 0,o.attr("foo",function(){return null}),t),"foo"),e.equal((t=void 0,o.attr("svg:foo",function(){return null}),t),"svg:foo"),e.end()}),tape("selection.attr(name, value) sets the value of the attribute with the specified name on the selected elements",function(e){var t=jsdom("<h1 id='one' class='c1 c2'>hello</h1><h1 id='two' class='c3'></h1>"),o=t.querySelector("#one"),a=t.querySelector("#two"),n=d3.selectAll([o,a]);e.equal(n.attr("foo","bar"),n),e.equal(o.getAttribute("foo"),"bar"),e.equal(a.getAttribute("foo"),"bar"),e.end()}),tape("selection.attr(name, null) removes the attribute with the specified name on the selected elements",function(e){var t=jsdom("<h1 id='one' foo='bar' class='c1 c2'>hello</h1><h1 id='two' foo='bar' class='c3'></h1>"),o=t.querySelector("#one"),a=t.querySelector("#two"),n=d3.selectAll([o,a]);e.equal(n.attr("foo",null),n),e.equal(o.hasAttribute("foo"),!1),e.equal(a.hasAttribute("foo"),!1),e.end()}),tape("selection.attr(name, function) sets the value of the attribute with the specified name on the selected elements",function(e){var t=jsdom("<h1 id='one' class='c1 c2'>hello</h1><h1 id='two' class='c3'></h1>"),o=t.querySelector("#one"),a=t.querySelector("#two"),n=d3.selectAll([o,a]);e.equal(n.attr("foo",function(e,t){return t?"bar-"+t:null}),n),e.equal(o.hasAttribute("foo"),!1),e.equal(a.getAttribute("foo"),"bar-1"),e.end()}),tape("selection.attr(name, function) passes the value function data, index and group",function(e){var t=jsdom("<parent id='one'><child id='three'></child><child id='four'></child></parent><parent id='two'><child id='five'></child></parent>"),o=t.querySelector("#one"),a=t.querySelector("#two"),n=t.querySelector("#three"),r=t.querySelector("#four"),l=t.querySelector("#five"),s=[];d3.selectAll([o,a]).datum(function(e,t){return"parent-"+t}).selectAll("child").data(function(e,t){return[0,1].map(function(e){return"child-"+t+"-"+e})}).attr("foo",function(e,t,o){s.push([this,e,t,o])}),e.deepEqual(s,[[n,"child-0-0",0,[n,r]],[r,"child-0-1",1,[n,r]],[l,"child-1-0",0,[l]]]),e.end()});