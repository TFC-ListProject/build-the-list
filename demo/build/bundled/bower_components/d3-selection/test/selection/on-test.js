var tape=require("tape"),jsdom=require("../jsdom"),d3=require("../../");tape("selection.on(type, listener) registers a listeners for the specified event type on each selected element",function(e){var o=0,n=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),l=n.querySelector("#one"),t=n.querySelector("#two"),c=d3.selectAll([l,t]);e.equal(c.on("click",function(){++o}),c),c.dispatch("click"),e.equal(o,2),c.dispatch("tick"),e.equal(o,2),e.end()}),tape("selection.on(type, listener) observes the specified name, if any",function(e){var o=0,n=0,l=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),t=l.querySelector("#one"),c=l.querySelector("#two"),i=d3.selectAll([t,c]).on("click.foo",function(){++o}).on("click.bar",function(){++n});i.dispatch("click"),e.equal(o,2),e.equal(n,2),e.end()}),tape("selection.on(type, listener, capture) observes the specified capture flag, if any",function(e){var o,n=d3.select({addEventListener:function(e,n,l){o=l}});e.equal(n.on("click.foo",function(){},!0),n),e.deepEqual(o,!0),e.end()}),tape("selection.on(type) returns the listener for the specified event type, if any",function(e){var o=function(){},n=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),l=n.querySelector("#one"),t=n.querySelector("#two"),c=d3.selectAll([l,t]).on("click",o);e.equal(c.on("click"),o),e.end()}),tape("selection.on(type) observes the specified name, if any",function(e){var o=function(){},n=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),l=n.querySelector("#one"),t=n.querySelector("#two"),c=d3.selectAll([l,t]).on("click.foo",o);e.equal(c.on("click"),void 0),e.equal(c.on("click.foo"),o),e.equal(c.on("click.bar"),void 0),e.equal(c.on("tick.foo"),void 0),e.equal(c.on(".foo"),void 0),e.end()}),tape("selection.on(type, null) removes the listener with the specified name, if any",function(e){var o=0,n=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),l=n.querySelector("#one"),t=n.querySelector("#two"),c=d3.selectAll([l,t]).on("click",function(){++o});e.equal(c.on("click",null),c),e.equal(c.on("click"),void 0),c.dispatch("click"),e.equal(o,0),e.end()}),tape("selection.on(type, null) observes the specified name, if any",function(e){var o=0,n=0,l=function(){++o},t=function(){++n},c=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),i=c.querySelector("#one"),a=c.querySelector("#two"),u=d3.selectAll([i,a]).on("click.foo",l).on("click.bar",t);e.equal(u.on("click.foo",null),u),e.equal(u.on("click.foo"),void 0),e.equal(u.on("click.bar"),t),u.dispatch("click"),e.equal(o,0),e.equal(n,2),e.end()}),tape("selection.on(type, null, capture) ignores the specified capture flag, if any",function(e){var o=0,n=function(){++o},l=jsdom(),t=d3.select(l).on("click.foo",n,!0);t.dispatch("click"),e.equal(o,1),t.on(".foo",null,!1).dispatch("click"),e.equal(o,1),e.equal(t.on("click.foo"),void 0),e.end()}),tape("selection.on(name, null) removes all listeners with the specified name",function(e){var o=0,n=0,l=function(){++o},t=function(){++n},c=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),i=c.querySelector("#one"),a=c.querySelector("#two"),u=d3.selectAll([i,a]).on("click.foo",l).on("load.foo",t);e.equal(u.on("click.foo"),l),e.equal(u.on("load.foo"),t),u.dispatch("click"),u.dispatch("load"),e.equal(o,2),e.equal(n,2),e.equal(u.on(".foo",null),u),e.equal(u.on("click.foo"),void 0),e.equal(u.on("load.foo"),void 0),u.dispatch("click"),u.dispatch("load"),e.equal(o,2),e.equal(n,2),e.end()}),tape("selection.on(name, null) can remove a listener with capture",function(e){var o=0,n=function(){++o},l=jsdom(),t=d3.select(l).on("click.foo",n,!0);t.dispatch("click"),e.equal(o,1),t.on(".foo",null).dispatch("click"),e.equal(o,1),e.equal(t.on("click.foo"),void 0),e.end()}),tape("selection.on(name, listener) has no effect",function(e){var o=0,n=function(){++o},l=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),t=l.querySelector("#one"),c=l.querySelector("#two"),i=d3.selectAll([t,c]).on("click.foo",n);e.equal(i.on(".foo",function(){throw new Error}),i),e.equal(i.on("click.foo"),n),i.dispatch("click"),e.equal(o,2),e.end()}),tape("selection.on(type) skips missing elements",function(e){var o=function(){},n=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),l=n.querySelector("#one"),t=n.querySelector("#two");d3.selectAll([l,t]).on("click.foo",o);e.equal(d3.selectAll([,t]).on("click.foo"),o),e.end()}),tape("selection.on(type, listener) skips missing elements",function(e){var o=0,n=function(){++o},l=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),t=(l.querySelector("#one"),l.querySelector("#two")),c=d3.selectAll([,t]).on("click.foo",n);c.dispatch("click"),e.equal(o,1),e.end()}),tape("selection.on(type, listener) passes the listener data, index and group",function(e){var o=jsdom("<parent id='one'><child id='three'></child><child id='four'></child></parent><parent id='two'><child id='five'></child></parent>"),n=o.querySelector("#one"),l=o.querySelector("#two"),t=o.querySelector("#three"),c=o.querySelector("#four"),i=o.querySelector("#five"),a=[],u=d3.selectAll([n,l]).datum(function(e,o){return"parent-"+o}).selectAll("child").data(function(e,o){return[0,1].map(function(e){return"child-"+o+"-"+e})}).on("foo",function(e,o,n){a.push([this,e,o,n])});e.deepEqual(a,[]),u.dispatch("foo"),e.deepEqual(a,[[t,"child-0-0",0,[t,c]],[c,"child-0-1",1,[t,c]],[i,"child-1-0",0,[i]]]),e.end()}),tape("selection.on(type, listener) passes the listener the index as of registration time",function(e){var o,n=jsdom("<parent id='one'></parent>"),l=n.querySelector("#one"),t=d3.selectAll([,l]).on("click",function(e,n){o=n});t.dispatch("click"),e.deepEqual(t,{_groups:[[,l]],_parents:[null]}),e.equal(o,1),t=t.sort().dispatch("click"),e.deepEqual(t,{_groups:[[l]],_parents:[null]}),e.equal(o,1),e.end()});