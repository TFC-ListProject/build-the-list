var tape=require("tape"),jsdom=require("../jsdom"),d3=require("../../");tape("selection.data(values) binds the specified values to the selected elements by index",function(e){var t=jsdom("<div id='one'></div><div id='two'></div><div id='three'></div>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("div").data(["foo","bar","baz"]);e.equal(o.__data__,"foo"),e.equal(n.__data__,"bar"),e.equal(a.__data__,"baz"),e.deepEqual(d,{_groups:[[o,n,a]],_parents:[t],_enter:[[,,]],_exit:[[,,]]}),e.end()}),tape("selection.data(values) puts unbound data in the enter selection",function(e){var t=jsdom("<div id='one'></div><div id='two'></div>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=d3.select(t).selectAll("div").data(["foo","bar","baz"]);e.equal(o.__data__,"foo"),e.equal(n.__data__,"bar"),e.deepEqual(a,{_groups:[[o,n]],_parents:[t],_enter:[[,,{__data__:"baz",_next:null,_parent:t,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t.ownerDocument}]],_exit:[[,,]]}),e.end()}),tape("selection.data(values) puts unbound elements in the exit selection",function(e){var t=jsdom("<div id='one'></div><div id='two'></div><div id='three'></div>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("div").data(["foo","bar"]);e.equal(o.__data__,"foo"),e.equal(n.__data__,"bar"),e.deepEqual(d,{_groups:[[o,n]],_parents:[t],_enter:[[,,,]],_exit:[[,,a]]}),e.end()}),tape("selection.data(values) binds the specified values to each group independently",function(e){var t=jsdom("<div id='zero'><span id='one'></span><span id='two'></span></div><div id='three'><span id='four'></span><span id='five'></span></div>").body,o=t.querySelector("#zero"),n=t.querySelector("#one"),a=t.querySelector("#two"),d=t.querySelector("#three"),r=t.querySelector("#four"),i=t.querySelector("#five"),l=d3.select(t).selectAll("div").selectAll("span").data(["foo","bar"]);e.equal(n.__data__,"foo"),e.equal(a.__data__,"bar"),e.equal(r.__data__,"foo"),e.equal(i.__data__,"bar"),e.deepEqual(l,{_groups:[[n,a],[r,i]],_parents:[o,d],_enter:[[,],[,]],_exit:[[,],[,]]}),e.end()}),tape("selection.data(function) binds the specified return values to the selected elements by index",function(e){var t=jsdom("<div id='one'></div><div id='two'></div><div id='three'></div>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("div").data(function(){return["foo","bar","baz"]});e.equal(o.__data__,"foo"),e.equal(n.__data__,"bar"),e.equal(a.__data__,"baz"),e.deepEqual(d,{_groups:[[o,n,a]],_parents:[t],_enter:[[,,]],_exit:[[,,]]}),e.end()}),tape("selection.data(function) passes the values function datum, index and parents",function(e){var t=jsdom("<parent id='one'><child></child><child></child></parent><parent id='two'><child></child></parent>"),o=t.querySelector("#one"),n=t.querySelector("#two"),a=[];d3.selectAll([o,n]).datum(function(e,t){return"parent-"+t}).selectAll("child").data(function(e,t,o){return a.push([this,e,t,o]),["foo","bar"]}),e.deepEqual(a,[[o,"parent-0",0,[o,n]],[n,"parent-1",1,[o,n]]]),e.end()}),tape("selection.data(values, function) joins data to element using the computed keys",function(e){var t=jsdom("<node id='one'></node><node id='two'></node><node id='three'></node>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("node").data(["one","four","three"],function(e){return e||this.id});e.deepEqual(d,{_groups:[[o,,a]],_parents:[t],_enter:[[,{__data__:"four",_next:a,_parent:t,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t.ownerDocument}]],_exit:[[,n]]}),e.end()}),tape("selection.data(values, function) puts elements with duplicate keys into update or exit",function(e){var t=jsdom("<node id='one' name='foo'></node><node id='two' name='foo'></node><node id='three' name='bar'></node>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("node").data(["foo"],function(e){return e||this.getAttribute("name")});e.deepEqual(d,{_groups:[[o]],_parents:[t],_enter:[[,]],_exit:[[,n,a]]}),e.end()}),tape("selection.data(values, function) puts elements with duplicate keys into exit",function(e){var t=jsdom("<node id='one' name='foo'></node><node id='two' name='foo'></node><node id='three' name='bar'></node>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("node").data(["bar"],function(e){return e||this.getAttribute("name")});e.deepEqual(d,{_groups:[[a]],_parents:[t],_enter:[[,]],_exit:[[o,n]]}),e.end()}),tape("selection.data(values, function) puts data with duplicate keys into update and enter",function(e){var t=jsdom("<node id='one'></node><node id='two'></node><node id='three'></node>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("node").data(["one","one","two"],function(e){return e||this.id});e.deepEqual(d,{_groups:[[o,,n]],_parents:[t],_enter:[[,{__data__:"one",_next:n,_parent:t,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t.ownerDocument},,]],_exit:[[,,a]]}),e.end()}),tape("selection.data(values, function) puts data with duplicate keys into enter",function(e){var t=jsdom("<node id='one'></node><node id='two'></node><node id='three'></node>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("node").data(["foo","foo","two"],function(e){return e||this.id});e.deepEqual(d,{_groups:[[,,n]],_parents:[t],_enter:[[{__data__:"foo",_next:n,_parent:t,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t.ownerDocument},{__data__:"foo",_next:n,_parent:t,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t.ownerDocument}]],_exit:[[o,,a]]}),e.end()}),tape("selection.data(values, function) passes the key function datum, index and nodes or data",function(e){var t=jsdom("<node id='one'></node><node id='two'></node>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=[];d3.select(o).datum("foo"),d3.select(t).selectAll("node").data(["foo","bar"],function(e,t,o){return a.push([this,e,t,o]),e||this.id}),e.deepEqual(a,[[o,"foo",0,[o,n]],[n,void 0,1,[o,n]],[t,"foo",0,["foo","bar"]],[t,"bar",1,["foo","bar"]]]),e.end()}),tape("selection.data(values, function) applies the order of the data",function(e){var t=jsdom("<div id='one'></div><div id='two'></div><div id='three'></div>").body,o=t.querySelector("#one"),n=t.querySelector("#two"),a=t.querySelector("#three"),d=d3.select(t).selectAll("div").data(["four","three","one","five","two"],function(e){return e||this.id});e.deepEqual(d,{_groups:[[,a,o,,n]],_parents:[t],_enter:[[{__data__:"four",_next:a,_parent:t,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t.ownerDocument},,,{__data__:"five",_next:n,_parent:t,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t.ownerDocument}]],_exit:[[,,,]]}),e.end()}),tape("selection.data(values) returns a new selection, and does not modify the original selection",function(e){var t=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),o=t.documentElement,n=t.querySelector("#one"),a=t.querySelector("#two"),d=d3.select(o).selectAll("h1"),r=d.data([1,2,3]),i=r.data([1]);e.deepEqual(d,{_groups:[[n,a]],_parents:[o]}),e.deepEqual(r,{_groups:[[n,a]],_parents:[o],_enter:[[,,{__data__:3,_next:null,_parent:o,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t}]],_exit:[[,]]}),e.deepEqual(i,{_groups:[[n]],_parents:[o],_enter:[[,]],_exit:[[,a]]}),e.end()}),tape("selection.data(values, key) does not modify the groups array in-place",function(e){var t=jsdom("<h1 id='one'></h1><h1 id='two'></h1>"),o=t.documentElement,n=t.querySelector("#one"),a=t.querySelector("#two"),d=function(e,t){return t},r=d3.select(o).selectAll("h1"),i=r.data([1,2,3],d),l=i.data([1],d);e.deepEqual(r,{_groups:[[n,a]],_parents:[o]}),e.deepEqual(i,{_groups:[[n,a]],_parents:[o],_enter:[[,,{__data__:3,_next:null,_parent:o,namespaceURI:"http://www.w3.org/1999/xhtml",ownerDocument:t}]],_exit:[[,]]}),e.deepEqual(l,{_groups:[[n]],_parents:[o],_enter:[[,]],_exit:[[,a]]}),e.end()});