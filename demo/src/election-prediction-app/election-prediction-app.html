<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="election-prediction-district-charts.html">
<link rel="import" href="election-prediction-state-graph.html">

<!-- TODO: Do this differently -->
<style is="custom-style">
  .district {
    cursor: pointer;
    fill: var(--paper-red-500);
    transition: all 250ms ease-in-out;
  }

  .district.blue {
    fill: var(--paper-blue-700);
  }

  .district:hover {
    fill: white;
    stroke: var(--paper-grey-700);
  }
</style>

<dom-module id="election-prediction-app">
  <template>
    <style include="iron-flex">
      :host {
        --primary-color: var(--paper-blue-500);
        --accent-color: var(--paper-red-500);
        display: block;
        @apply(--paper-font-common-base);
        @apply(--layout-vertical);
      }

      app-header {
        background-color: var(--paper-blue-500);
        color: white;
      }

      app-toolbar {
        height: 48px;
      }

      paper-material {
        background-color: white;
        margin-bottom: 16px;
      }

      .main-content {
        padding: 16px;
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 0;
        }
      }
    </style>
    <app-location route="{{route}}" use-hash-as-path></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>
    <app-route route="{{subroute}}" pattern="/:id" data="{{subrouteData}}"></app-route>
    <app-header-layout fullbleed>
      <app-header shadow fixed>
        <app-toolbar>
          <paper-icon-button icon="arrow-back" on-tap="onBackTap_" hidden$="[[computeHideBackButton_(routeData.page)]]"></paper-icon-button>
          <div main-title>[[appTitle]]</div>
          <paper-icon-button icon="more-vert"></paper-icon-button>
        </app-toolbar>
      </app-header>
      <div class="main-content">
        <neon-animated-pages animate-initial-selection attr-for-selected="name" entry-animation="fade-in-animation" exit-animation="fade-out-animation" fallback-selection="state" selected="{{routeData.page}}">
          <election-prediction-state-graph app-title="{{stateTitle}}" name="state" state="{{state}}">
          </election-prediction-state-graph>
          <election-prediction-district-charts class="flex" district="[[subrouteData.id]]" app-title="{{districtTitle}}" name="district" state="[[state]]"></election-prediction-district-charts>
        </neon-animated-pages>
      </div>
    </app-header-layout>
  </template>
  <!-- TODO: Add these as dependencies -->
  <script src="../../bower_components/d3/d3.min.js"></script>
  <script>
    Polymer({

      is: 'election-prediction-app',

      properties: {
        appTitle: {
          type: String,
          computed: 'computeAppTitle_(stateTitle, districtTitle, routeData.page)'
        },
        state: String,
        route: Object,
        routeData: Object,
      },

      computeAppTitle_(stateTitle, districtTitle, page) {
        console.log(stateTitle, districtTitle, page);
        return page === 'district' ? districtTitle : stateTitle;
      },

      computeHideBackButton_(page) {
        return page === 'state';
      },

      onBackTap_() {
        this.set('routeData.page', 'state');
      }
    });
  </script>
</dom-module>
